@model IEnumerable<Biblioteca.Models.PrestamoLibro>

<h1>Gestion de Prestamos</h1>

<div class="card mb-4">
    <div class="card-body">
        <h4>Nuevo Préstamo</h4>
        <form asp-action="CrearPrestamo" method="post">
            <div class="row">
                <div class="col-md-5">
                    <label>Usuario</label>
                    <select name="UsuarioId" class="form-control">
                        <option value="">Seleccione un usuario</option>
                        @foreach (var usuario in ViewBag.Usuarios)
                        {
                            <option value="@usuario.Id">@usuario.Nombre</option>
                        }
                    </select>
                </div>

                <div class="col-md-5">
                    <label>Libro</label>
                    <select name="LibroId" class="form-control">
                        <option value="">Seleccione un libro</option>
                        @foreach (var libro in ViewBag.Libros)
                        {
                            <option value="@libro.Id">@libro.Titulo (@libro.EjemplaresDisponibles disponibles)</option>
                        }
                    </select>
                </div>

                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">Registrar</button>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-bordered">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Usuario</th>
            <th>Libro</th>
            <th>Fecha Préstamo</th>
            <th>Fecha Devolución</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.Id</td>
                <td>@item.Usuario?.Nombre</td>
                <td>@item.Libro?.Titulo</td>
                <td>@item.FechaPrestamo.ToString("dd/MM/yyyy")</td>
                <td>@(item.FechaDevolucion?.ToString("dd/MM/yyyy") ?? "-")</td>
                <td>
                    @if (item.Devuelto)
                    {
                        <span class="badge bg-success">Devuelto</span>
                    }
                    else
                    {
                        <span class="badge bg-warning text-dark">En préstamo</span>
                    }
                </td>
                <td>
                    @if (!item.Devuelto)
                    {
                        <a asp-action="DevolverLibro" asp-route-id="@item.Id" 
                           class="btn btn-success btn-sm"
                           onclick="return confirm('¿Confirmas la devolución del libro?')">
                            Devolver
                        </a>
                    }
                    else
                    {
                        <button class="btn btn-secondary btn-sm" disabled>Completado</button>
                    }
                </td>
            </tr>
        }
        </tbody>
    </table>
</div>